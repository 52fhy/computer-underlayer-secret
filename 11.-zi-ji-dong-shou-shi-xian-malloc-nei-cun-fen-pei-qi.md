# 11.自己动手实现malloc内存分配器

**对内存分配器透彻理解是编程高手的标志之一。**&#x20;

如果你不能理解malloc之类内存分配器实现原理的话，那你可能写不出高性能程序，写不出高性能程序就很难参与核心项目，参与不了核心项目那么很难升职加薪，很难升级加薪就无法走向人生巅峰，没想到内存分配竟如此关键，为了走上人生巅峰你也要势必读完本文。&#x20;

现在我们知道了，对内存分配器透彻的理解是写出高性能程序的关键所在，那么我们该怎样透彻理解内存分配器呢？

**还有什么能比你自己动手实现一个理解的更透彻吗？**

****![](.gitbook/assets/11\_1.jpg)****

接下来，我们就自己实现一个malloc内存分配器。读完本文后内存分配对你将不再是一个神秘的黑盒。&#x20;

在讲解实现原理之前，我们需要回答一个基本问题，那就是我们为什么要发明内存分配器这种东西。

**内存申请与释放**

程序员经常使用的内存申请方式被称为**动态内存分配**，Dynamic Memory Allocation。我们为什么需要动态的去进行内存分配与释放呢？

答案很简单，因为我们不能**提前知道程序到底需要使用多少内存**。那我们什么时候才能知道呢？答案是只有当程序真的**运行**起来后我们才知道。

![](.gitbook/assets/11\_2.jpg)

这就是为什么程序员需要动态的去申请内存的原因，如果能提前知道我们的程序到底需要多少内存，那么直接知道告诉编译器就好了，这样也不必发明malloc等内存分配器了。

知道了为什么要发明内存分配器的原因后，接下来我们着手实现一个。

**程序员应如何看待内存**

实际上，现代程序员是很幸福的，程序员很少去关心内存分配的问题。作为程序员，可以简单的认为我们的程序独占内存，注意，是独占哦。

![](.gitbook/assets/11\_3.jpg)

写程序时你从来没有关心过如果我们的程序占用过多内存会不会影响到其它程序，我们可以简单的认 为每个程序(进程)独占4G内存(32位操作系统)，即使我们的物理内存512M。不信你可以去试试，在即 使只有512M大小的内存上你依然可以申请到2G内存来使用，可这是为什么呢？关于这个问题我们会 在《深入理解操作系统》系列中详细阐述。



****

****

****

****

****
